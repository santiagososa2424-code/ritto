- name: Call Supabase Edge Function
  env:
    FUNCTION_URL: ${{ secrets.SUPABASE_REMINDER_FUNCTION_URL }}
    CRON_SECRET: ${{ secrets.CRON_SECRET }}
  run: |
    if [ -z "$FUNCTION_URL" ]; then
      echo "Missing secret: SUPABASE_REMINDER_FUNCTION_URL"
      exit 1
    fi

    echo "FUNCTION_URL=[$FUNCTION_URL]"

    curl -sS -X GET "$FUNCTION_URL" \
      -H "x-cron-secret: $CRON_SECRET" \
      -H "Content-Type: application/json" \
      -o /tmp/body.txt \
      -w "\nHTTP_CODE=%{http_code}\n" || true

    echo "---- BODY ----"
    cat /tmp/body.txt || true
    echo "-------------"
